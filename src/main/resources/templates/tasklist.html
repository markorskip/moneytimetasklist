<html xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head th:insert="fragments/header :: header">

   <style>
       .centered {
           position: fixed;
           top: 50%;
           left: 50%;
           /* bring your own prefixes */
           transform: translate(-50%, -50%);
       }

   </style>
</head>
<body>
<div id="app" class="centered">
    <div th:insert="fragments/navbar :: navbar"></div>

<!--<div @click="toggleEditName">-->
    <!--<div v-if="!editName">{{ name }} </div>-->
    <!--<div v-else><input v-model="name"></div>-->
<!--</div>-->


    <div id="main">
    <task v-for="task,index in tasks"
          :task="task"
          :key="index"
          :index="index"
          v-on:add-child="addChild($event)"
          v-on:delete-task="deleteTask($event)"
          v-on:toggle-edit="toggleEdit($event)"
    ></task>

        <button @click="addRoot()">Add a Root Task</button>
        <button @click="refresh()">Refresh Data</button>
        <button @click="save()"> Save Data</button>
        <pre v-if="debug">{{ tasks }} </pre>
    </div>

</div>

<template id="task">
    <div class="task" :style="indent">

        <!-- Normal display -->
        <div v-if="!task.edit">

            <i class="fas fa-edit"  v-on:click="$emit('toggle-edit', index)"></i>
            <i class="fas fa-plus"  v-on:click="$emit('add-child', [task, index])"></i>
            <i v-if="!task.children" class="fas fa-trash" v-on:click="$emit('delete-task', [task, index])"></i>
            <i class="fas fa-ban" title="Disable feature not available yet"></i>
            <b :id="'task'+index" :title=task.label >{{ task.label }}</b>

            <b-popover :target="'task'+index">
                <table>
                    <tr><td>Initial Cost Estimate: </td><td>${{ task.estimatedCost }}</td></tr>
                    <tr><td>Initial Time Estimate: </td><td>{{ task.estimatedTime }} hours</td></tr>
                    <tr><td>Date Created</td><td>{{ task.createdDate }}</td></tr>
                </table>
            </b-popover>

            <span v-if="!task.children">
            Cost: ${{ task.cost }}
            Time: {{ task.time }} hours
            </span>
            <span v-else>
            Total Cost: ${{task.cost}}
            Total Time: {{ task.time }} hours
            </span>

        </div>

        <!-- Edit mode -->
        <div v-if="task.edit">

            <i class="fas fa-save" v-on:click="$emit('toggle-edit',index)"></i>
            <i v-if="!task.children" class="fas fa-trash" v-on:click="$emit('delete-task', [task, index])"></i>
            Label: <input v-model="task.label">
            Cost Estimate: <input v-model="task.estimatedCost">
            Time Estimate: <input v-model="task.estimatedTime">
            Complete? <input type="checkbox" v-model="task.complete">
        </div>
    </div>
</template>
</body>
<script th:inline="javascript">
    var tasklist_id = [[${taskListId}]];
</script>
<script src="/js/tasklist.js"></script>
</html>